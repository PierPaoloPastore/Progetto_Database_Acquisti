{% extends "base.html" %}

{% block title %}Scadenzario Pagamenti - Gestionale Acquisti{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1><i class="bi bi-calendar-check"></i> Scadenzario Pagamenti</h1>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-white">
            <h5 class="mb-0">Fatture in Scadenza / Non Pagate</h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover table-striped mb-0 align-middle">
                    <thead class="table-light">
                    <tr>
                        <th>Scadenza</th>
                        <th>Fornitore</th>
                        <th>N. Doc</th>
                        <th class="text-end">Importo Totale</th>
                        <th class="text-end">Azioni</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for doc in overdue_invoices %}
                      <tr class="{{ 'table-danger' if doc.due_date and doc.due_date < today else '' }}">
                          <td>
                              {% if doc.due_date %}
                                {{ doc.due_date.strftime('%d/%m/%Y') }}
                                {% if doc.due_date < today %}
                                    <span class="badge bg-danger ms-1">Scaduta</span>
                                {% endif %}
                              {% else %}
                                <span class="text-muted">-</span>
                              {% endif %}
                          </td>
                          <td>
                              <a href="{{ url_for('suppliers.detail_view', supplier_id=doc.supplier_id) }}" class="text-decoration-none fw-bold">
                                  {{ doc.supplier.name }}
                              </a>
                          </td>
                          <td>{{ doc.document_number }}</td>
                          <td class="text-end">{{ "%.2f"|format(doc.total_gross_amount) }} â‚¬</td>
                          <td class="text-end">
                              <a href="{{ url_for('documents.detail_view', document_id=doc.id) }}" 
                                 class="btn btn-sm btn-primary">
                                  <i class="bi bi-cash-coin"></i> Registra Pagamento
                              </a>
                          </td>
                      </tr>
                    {% else %}
                      <tr>
                          <td colspan="5" class="text-center py-5 text-muted">
                              <i class="bi bi-check-circle fs-1 d-block mb-3 text-success"></i>
                              Ottimo! Non ci sono fatture in sospeso.
                          </td>
                      </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
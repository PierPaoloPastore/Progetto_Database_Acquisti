{% extends "base.html" %}

{% block title %}Fatture - Gestionale Acquisti{% endblock %}

{% block content %}
<h1>Fatture</h1>

<section class="panel">
    <h2>Filtri</h2>
    <form method="get" class="form-inline filters-form" id="invoice-filters-form">
        <div class="form-row">
            <label for="date_from">Data da</label>
            <input type="date" id="date_from" name="date_from"
                  value="{{ filters.date_from.strftime('%Y-%m-%d') if filters.date_from }}">
        </div>
        <div class="form-row">
            <label for="date_to">Data a</label>
            <input type="date" id="date_to" name="date_to"
                  value="{{ filters.date_to.strftime('%Y-%m-%d') if filters.date_to }}">
        </div>
        <div class="form-row">
            <label for="supplier_id">Fornitore</label>
            <select id="supplier_id" name="supplier_id">
                <option value="">Tutti</option>
                {% for s in suppliers %}
                  <option value="{{ s.id }}"
                    {% if filters.supplier_id and filters.supplier_id == s.id %}selected{% endif %}>
                    {{ s.name }}
                  </option>
                {% endfor %}
            </select>
        </div>
        <div class="form-row">
            <label for="payment_status">Stato pagamento</label>
            <select id="payment_status" name="payment_status">
                <option value="">Tutti</option>
                {% for status in ["unpaid", "partial", "paid"] %}
                  <option value="{{ status }}"
                    {% if filters.payment_status == status %}selected{% endif %}>
                    {{ status }}
                  </option>
                {% endfor %}
            </select>
        </div>
        <div class="form-row">
            <label for="min_total">Importo minimo</label>
            <input type="number" step="0.01" id="min_total" name="min_total"
                   value="{{ filters.min_total if filters.min_total is not none }}">
        </div>
        <div class="form-row">
            <label for="max_total">Importo massimo</label>
            <input type="number" step="0.01" id="max_total" name="max_total"
                   value="{{ filters.max_total if filters.max_total is not none }}">
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-primary">Applica filtri</button>
            <a href="{{ url_for('invoices.list_view') }}" class="btn-secondary">Reset</a>
        </div>
    </form>
</section>

<section class="panel">
    <h2>Elenco fatture ({{ invoices|length }})</h2>
    <div class="table-wrapper">
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>ID</th>
                <th>Data</th>
                <th>Numero</th>
                <th>Fornitore</th>
                <th>Totale lordo</th>
                <th>Stato pagamento</th>
                <th>Scadenza</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            {% for inv in invoices %}
              <tr>
                  <td>{{ inv.id }}</td>
                  <td>{{ inv.invoice_date.strftime('%d/%m/%Y') if inv.invoice_date }}</td>
                  <td>{{ inv.invoice_number }}</td>
                  <td>{{ inv.supplier.name if inv.supplier }}</td>
                  <td class="text-right">
                      {{ "%.2f"|format(inv.total_gross_amount or 0) }}
                  </td>
                  <td>{{ inv.payment_status }}</td>
                  <td>
                      {{ inv.due_date.strftime('%d/%m/%Y') if inv.due_date }}
                  </td>
                  <td>
                      <a href="{{ url_for('invoices.detail_view', invoice_id=inv.id) }}"
                         class="btn-link">Dettaglio</a>
                  </td>
              </tr>
            {% else %}
              <tr>
                  <td colspan="8" class="text-center">
                      Nessuna fattura trovata con i filtri correnti.
                  </td>
              </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}

{% extends "base.html" %}

{% block title %}Categorie - Gestionale Acquisti{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Categorie gestionali</h1>
    </div>

    <div class="card mb-3">
        <div class="card-header bg-white">
            <h5 class="mb-0">Nuova / Modifica categoria</h5>
        </div>
        <div class="card-body">
            <form method="post" action="{{ url_for('categories.save_view') }}" class="row g-3">
                <input type="hidden" name="category_id" id="category_id" value="">
                <div class="col-md-4">
                    <label for="name" class="form-label">Nome *</label>
                    <input type="text" id="name" name="name" class="form-control" required>
                </div>
                <div class="col-md-5">
                    <label for="description" class="form-label">Descrizione</label>
                    <input type="text" id="description" name="description" class="form-control">
                </div>
                <div class="col-md-3">
                    <label for="vat_rate" class="form-label">Aliquota IVA (%)</label>
                    <input type="number" step="0.01" id="vat_rate" name="vat_rate" class="form-control" placeholder="es. 22">
                </div>
                <div class="col-12 d-flex gap-2">
                    <button type="submit" class="btn btn-primary">Salva</button>
                    <button type="reset" class="btn btn-outline-secondary" id="category-form-reset">Reset</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-white">
            <h5 class="mb-0">Elenco categorie ({{ categories|length|format_int }})</h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive scrollable-list">
                <table class="table table-hover table-striped mb-0 align-middle" id="categories-table">
                    <thead class="table-light">
                    <tr>
                        <th>Nome</th>
                        <th>Descrizione</th>
                        <th class="text-end">IVA %</th>
                        <th class="text-center">Stato</th>
                        <th class="text-end">Azioni</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for c in categories %}
                      <tr data-category-id="{{ c.id }}"
                          data-category-name="{{ c.name }}"
                          data-category-description="{{ c.description or '' }}"
                          data-category-vat="{{ c.vat_rate or '' }}">
                          <td class="fw-bold">{{ c.name }}</td>
                          <td>{{ c.description or '-' }}</td>
                          <td class="text-end font-monospace">
                              {% if c.vat_rate is not none %}
                                {{ c.vat_rate|format_number(2) }}
                              {% else %}
                                -
                              {% endif %}
                          </td>
                          <td class="text-center">
                              {% if c.is_active %}
                                <span class="badge bg-success">Attiva</span>
                              {% else %}
                                <span class="badge bg-secondary">Inattiva</span>
                              {% endif %}
                          </td>
                          <td class="text-end">
                              <button type="button" class="btn btn-sm btn-outline-secondary me-2 category-edit-btn">
                                  <i class="bi bi-pencil"></i> Modifica
                              </button>
                              <form method="post" action="{{ url_for('categories.toggle_view', category_id=c.id) }}" class="d-inline">
                                  <input type="hidden" name="is_active" value="{{ '0' if c.is_active else '1' }}">
                                  {% if c.is_active %}
                                    <button type="submit" class="btn btn-sm btn-outline-danger">
                                        <i class="bi bi-slash-circle"></i> Disattiva
                                    </button>
                                  {% else %}
                                    <button type="submit" class="btn btn-sm btn-outline-success">
                                        <i class="bi bi-check-circle"></i> Riattiva
                                    </button>
                                  {% endif %}
                              </form>
                          </td>
                      </tr>
                    {% else %}
                      <tr>
                          <td colspan="5" class="text-center py-5 text-muted">
                              Nessuna categoria definita.
                          </td>
                      </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/categories_assign.js') }}"></script>
{% endblock %}
